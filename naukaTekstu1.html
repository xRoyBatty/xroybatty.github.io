<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Nauka Angielskiego</title>
    <style>
        /* --- Global Styles & Variables --- */
        :root {
            --primary-color: #3498db; /* Nice blue */
            --secondary-color: #f1c40f; /* Yellow */
            --accent-color: #e74c3c; /* Red for delete/cancel */
            --success-color: #2ecc71; /* Green */
            --background-color: #f4f6f9;
            --surface-color: #ffffff;
            --text-color: #34495e;
            --text-light: #7f8c8d;
            --border-color: #e1e5ea;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --tile-hover-shadow: rgba(0, 0, 0, 0.15);

            --font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex; /* Needed for vertical centering if content is short */
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            background-color: var(--surface-color);
            border-radius: 12px;
            box-shadow: 0 5px 20px var(--shadow-color);
            width: 100%;
            max-width: 1000px;
            overflow: hidden; /* Contain child elements */
            display: flex;
            flex-direction: column;
        }

        h1, h2, h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }
         h1 {
             background-color: var(--primary-color);
             color: white;
             padding: 20px;
             margin: 0 0 25px 0; /* Remove default margin, add bottom */
             font-size: 1.8em;
         }
         h2 {
            margin-top: 20px;
            font-size: 1.5em;
         }

        /* --- Utility Classes --- */
        .hidden {
            display: none !important; /* Force hide */
        }
        .content-padding {
             padding: 20px 30px;
        }


        /* --- Dashboard View --- */
        #dashboard-view h2 {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 25px;
        }

        .dashboard-actions {
            text-align: center;
            margin-bottom: 25px;
        }

        #text-tiles-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* Responsive grid */
            gap: 20px;
            padding-bottom: 20px; /* Space at the bottom */
        }

        .text-tile {
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px var(--shadow-color);
            transition: box-shadow 0.3s ease, transform 0.2s ease;
            display: flex;
            flex-direction: column;
            border-left: 5px solid var(--primary-color); /* Default color indicator */
        }

        .text-tile:hover {
            box-shadow: 0 4px 10px var(--tile-hover-shadow);
            transform: translateY(-3px);
        }

        .tile-content {
            flex-grow: 1; /* Take available space */
            margin-bottom: 15px;
        }
        .tile-content h4 {
            color: var(--text-color);
            margin-bottom: 8px;
            font-size: 1.1em;
            /* Optional: Truncate long titles */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .tile-content p {
            font-size: 0.9em;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .tile-actions {
            display: flex;
            justify-content: space-between; /* Space out buttons */
            gap: 10px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
            margin-top: auto; /* Push actions to the bottom */
        }

        /* --- Edit/Add View --- */
        #edit-view {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 0 30px 30px 30px; /* Add margin */
            padding: 25px;
            background-color: #fdfdff; /* Slightly different bg */
        }

        #edit-view h2 {
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        .form-group textarea {
            width: 100%;
            height: 200px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1em;
            resize: vertical;
            background-color: #fdfdfd;
        }
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }


        .color-picker-group label {
             display: block;
             font-weight: bold;
             margin-bottom: 8px;
             color: var(--primary-color);
        }
        .color-picker-group input[type="color"] {
            width: 60px;
            height: 35px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            padding: 2px; /* Small padding around color */
        }

        .edit-actions {
            text-align: right;
            margin-top: 25px;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }


        /* --- Game View (Placeholder/Basic structure) --- */
        #game-view {
            /* Add styles later when game logic is integrated */
             padding: 20px 30px;
        }
         #game-view .game-controls {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
         }
         #game-area-placeholder { /* Placeholder styling */
             min-height: 200px;
             border: 1px dashed var(--border-color);
             display: flex;
             align-items: center;
             justify-content: center;
             color: var(--text-light);
             border-radius: 8px;
             background-color: #fafafa;
         }
         #results-area-placeholder {
             margin-top: 20px;
             padding: 15px;
             background-color: #e9f3fe;
             border-radius: 5px;
             text-align: center;
             color: var(--text-light);
         }


        /* --- Buttons --- */
        button {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.2s ease;
            font-weight: 500;
        }
        button:active {
            transform: scale(0.98);
        }
         button:focus {
             outline: none;
             box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3); /* Focus outline */
         }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: #2980b9; /* Darker blue */
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
         .btn-secondary:hover {
            background-color: #f39c12; /* Darker yellow */
        }

        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }
        .btn-danger:hover {
            background-color: #c0392b; /* Darker red */
        }

        .btn-success {
             background-color: var(--success-color);
             color: white;
         }
        .btn-success:hover {
             background-color: #27ae60; /* Darker green */
         }


        .btn-edit, .btn-delete, .btn-study {
            padding: 6px 12px; /* Smaller buttons for tiles */
            font-size: 0.9em;
        }

         .btn-edit { background-color: var(--primary-color); color: white; }
         .btn-edit:hover { background-color: #2980b9; }

         .btn-delete { background-color: var(--accent-color); color: white; }
         .btn-delete:hover { background-color: #c0392b; }

         .btn-study { background-color: var(--success-color); color: white; }
         .btn-study:hover { background-color: #27ae60; }

        /* --- Responsiveness --- */
        @media (max-width: 768px) {
             .app-container {
                 margin: 10px;
                 padding: 0;
             }
             h1 {
                 font-size: 1.5em;
                 padding: 15px;
             }
            .content-padding {
                padding: 15px;
            }
             #text-tiles-container {
                 grid-template-columns: 1fr; /* Stack tiles */
                 gap: 15px;
             }
             .form-grid {
                 grid-template-columns: 1fr; /* Stack form fields */
                 gap: 15px;
             }
             .form-group textarea {
                height: 150px;
             }
             .edit-actions {
                justify-content: center; /* Center buttons on small screens */
             }
        }

    </style>
</head>
<body>

    <div class="app-container">
        <h1>Nauka Angielskiego - Dashboard</h1>

        <!-- ==================== DASHBOARD VIEW ==================== -->
        <div id="dashboard-view" class="content-padding">
            <h2>Twoje Teksty do Nauki</h2>
            <div class="dashboard-actions">
                <button id="add-new-text-btn" class="btn-primary">Dodaj Nowy Tekst</button>
            </div>
            <div id="text-tiles-container">
                <!-- Teksty będą wstrzykiwane tutaj przez JS -->
                <!-- Example Tile Structure (for reference):
                <div class="text-tile" data-id="1" style="border-left-color: #3498db;">
                    <div class="tile-content">
                        <h4>Przykładowy Tytuł (PL)</h4>
                        <p>Postęp: 75%</p>
                        <p>Dokładność: 92%</p>
                    </div>
                    <div class="tile-actions">
                        <button class="btn-study" data-id="1">Ucz się</button>
                        <button class="btn-edit" data-id="1">Edytuj</button>
                        <button class="btn-delete" data-id="1">Usuń</button>
                    </div>
                </div>
                 -->
            </div>
        </div>

        <!-- ==================== ADD/EDIT TEXT VIEW ==================== -->
        <div id="edit-view" class="hidden">
             <!-- Tytuł H2 będzie ustawiany przez JS -->
            <h2></h2>
            <input type="hidden" id="edit-text-id"> <!-- Hidden field to store ID when editing -->

            <div class="form-grid">
                <div class="form-group">
                    <label for="edit-polish-input">Tekst po Polsku (jedno zdanie na linię):</label>
                    <textarea id="edit-polish-input" placeholder="Wpisz tekst po polsku..." spellcheck="false"></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-english-input">Tekst po Angielsku (jedno zdanie na linię):</label>
                    <textarea id="edit-english-input" placeholder="Wpisz dokładne tłumaczenie..." spellcheck="false"></textarea>
                </div>
            </div>

             <div class="color-picker-group">
                 <label for="edit-color-input">Wybierz kolor kafelka:</label>
                 <input type="color" id="edit-color-input" value="#3498db"> <!-- Default color -->
             </div>

            <div class="edit-actions">
                <button id="cancel-edit-btn" class="btn-danger">Anuluj</button>
                <button id="save-text-btn" class="btn-success">Zapisz Tekst</button>
            </div>
        </div>

        <!-- ==================== GAME VIEW (Placeholder) ==================== -->
        <div id="game-view" class="hidden">
            <h2>Tryb Nauki: <span id="game-text-title">Nazwa Tekstu</span></h2>
            <!-- Tutaj w przyszłości znajdzie się interfejs gry (jak w poprzedniej wersji) -->
             <div id="game-area-placeholder">
                 <p>Interfejs gry pojawi się tutaj...</p>
             </div>
             <div id="results-area-placeholder">
                 <p>Wyniki pojawią się tutaj...</p>
             </div>
             <div class="game-controls">
                 <button id="check-answer-btn-placeholder" class="btn-primary">Sprawdź (Placeholder)</button>
                 <button id="next-round-btn-placeholder" class="btn-secondary hidden">Następna Runda (Placeholder)</button>
                <button id="back-to-dashboard-btn" class="btn-danger">Powrót do Dashboardu</button>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const dashboardView = document.getElementById('dashboard-view');
            const editView = document.getElementById('edit-view');
            const gameView = document.getElementById('game-view');
            const textTilesContainer = document.getElementById('text-tiles-container');
            const addNewTextBtn = document.getElementById('add-new-text-btn');
            const saveTextBtn = document.getElementById('save-text-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const backToDashboardBtn = document.getElementById('back-to-dashboard-btn');

            // Edit Form Elements
            const editFormTitle = editView.querySelector('h2');
            const editPolishInput = document.getElementById('edit-polish-input');
            const editEnglishInput = document.getElementById('edit-english-input');
            const editColorInput = document.getElementById('edit-color-input');
            const editTextIdInput = document.getElementById('edit-text-id');

             // Game View Elements (Placeholders for now)
             const gameTextTitle = document.getElementById('game-text-title');


            // --- Mock Data (In a real app, this would come from localStorage or a server) ---
            let learningTexts = [
                { id: 1, polish: "To jest mój dom.\nLubię psy.", english: "This is my house.\nI like dogs.", color: "#3498db", accuracy: 85, progress: 70 },
                { id: 2, polish: "Jaka jest pogoda?\nPada deszcz.", english: "What's the weather like?\nIt's raining.", color: "#f1c40f", accuracy: 92, progress: 100 },
                 { id: 3, polish: "Muszę iść do sklepu.", english: "I need to go to the shop.", color: "#2ecc71", accuracy: null, progress: 0 }
            ];
            let nextId = 4; // Simple ID generator

            // --- Functions ---

            // Show specific view, hide others
            function showView(viewToShow) {
                dashboardView.classList.add('hidden');
                editView.classList.add('hidden');
                gameView.classList.add('hidden');
                viewToShow.classList.remove('hidden');
            }

            // Render dashboard tiles based on learningTexts data
                        
            function renderDashboard() {
                textTilesContainer.innerHTML = ''; // Clear existing tiles

                // Get the computed style to access CSS variables
                const computedStyle = getComputedStyle(document.documentElement); // Use documentElement (root)
                const defaultTileColor = computedStyle.getPropertyValue('--primary-color').trim(); // Get the value and remove potential whitespace

                if (learningTexts.length === 0) {
                     textTilesContainer.innerHTML = '<p style="text-align:center; color: var(--text-light); grid-column: 1 / -1;">Nie masz jeszcze żadnych tekstów. Dodaj nowy!</p>';
                     return;
                 }

                learningTexts.forEach(text => {
                    const tile = document.createElement('div');
                    tile.classList.add('text-tile');
                    tile.dataset.id = text.id;
                    // CORRECTED LINE: Use the retrieved JS variable 'defaultTileColor' as fallback
                    tile.style.borderLeftColor = text.color || defaultTileColor;

                    // Limit title preview length
                    const titlePreview = text.polish.split('\n')[0] || 'Tekst bez tytułu'; // First line as title
                    const truncatedTitle = titlePreview.length > 40 ? titlePreview.substring(0, 37) + '...' : titlePreview;

                    tile.innerHTML = `
                        <div class="tile-content">
                            <h4>${truncatedTitle}</h4>
                             <p>Postęp: ${text.progress !== undefined ? text.progress + '%' : 'N/A'}</p>
                             <p>Dokładność: ${text.accuracy !== null && text.accuracy !== undefined ? text.accuracy + '%' : 'N/A'}</p>
                        </div>
                        <div class="tile-actions">
                            <button class="btn-study" data-id="${text.id}">Ucz się</button>
                            <button class="btn-edit" data-id="${text.id}">Edytuj</button>
                            <button class="btn-delete" data-id="${text.id}">Usuń</button>
                        </div>
                    `;
                    textTilesContainer.appendChild(tile);
                });
            }

             // Prepare and show the Add/Edit form
             function showEditForm(textToEdit = null) {
                 if (textToEdit) {
                     // Editing existing text
                     editFormTitle.textContent = 'Edytuj Tekst';
                     editTextIdInput.value = textToEdit.id;
                     editPolishInput.value = textToEdit.polish;
                     editEnglishInput.value = textToEdit.english;
                     editColorInput.value = textToEdit.color || '#3498db';
                 } else {
                     // Adding new text
                     editFormTitle.textContent = 'Dodaj Nowy Tekst';
                     editTextIdInput.value = ''; // Clear ID field
                     editPolishInput.value = '';
                     editEnglishInput.value = '';
                     editColorInput.value = '#3498db'; // Reset to default color
                 }
                 showView(editView);
             }

             // Save text (add or update)
             function saveText() {
                 const id = editTextIdInput.value ? parseInt(editTextIdInput.value, 10) : null;
                 const polish = editPolishInput.value.trim();
                 const english = editEnglishInput.value.trim();
                 const color = editColorInput.value;

                 if (!polish || !english) {
                     alert('Pola tekstowe po polsku i angielsku nie mogą być puste!');
                     return;
                 }
                  // Rudimentary line count check
                  const polishLines = polish.split('\n').filter(line => line.trim() !== '').length;
                  const englishLines = english.split('\n').filter(line => line.trim() !== '').length;
                   if (polishLines === 0 || englishLines === 0) {
                       alert('Wprowadź przynajmniej jedno zdanie w każdym polu!');
                       return;
                   }
                   if (polishLines !== englishLines) {
                       alert('Liczba linii (zdań) w obu polach musi być taka sama!');
                       return;
                   }


                 if (id) {
                     // Update existing text
                     const index = learningTexts.findIndex(text => text.id === id);
                     if (index !== -1) {
                         learningTexts[index].polish = polish;
                         learningTexts[index].english = english;
                         learningTexts[index].color = color;
                         // Keep existing progress/accuracy or reset if desired
                     }
                 } else {
                     // Add new text
                     learningTexts.push({
                         id: nextId++,
                         polish: polish,
                         english: english,
                         color: color,
                         accuracy: null, // New text starts with no stats
                         progress: 0
                     });
                 }

                 renderDashboard();
                 showView(dashboardView);
                 // In a real app, you'd save `learningTexts` here
             }

             // Delete text
             function deleteText(id) {
                if (confirm('Czy na pewno chcesz usunąć ten tekst? Tej operacji nie można cofnąć.')) {
                     learningTexts = learningTexts.filter(text => text.id !== id);
                     renderDashboard();
                      // In a real app, you'd save `learningTexts` here
                }
             }

            // Start learning mode for a specific text
            function startLearning(id) {
                 const text = learningTexts.find(text => text.id === id);
                 if (text) {
                     gameTextTitle.textContent = text.polish.split('\n')[0] || 'Wybrany Tekst'; // Use first line as title
                     console.log("Starting learning for:", text); // Placeholder action
                     // TODO: Integrate the actual game logic here
                     // 1. Get polish and english lines:
                     //    const polishLines = text.polish.split('\n').filter(line => line.trim() !== '');
                     //    const englishLines = text.english.split('\n').filter(line => line.trim() !== '');
                     // 2. Clear previous game state (if any)
                     // 3. Call a function like `initializeGame(polishLines, englishLines)` from the previous script
                     // 4. Populate #game-area-placeholder and #results-area-placeholder with actual game UI
                     showView(gameView);
                 } else {
                    alert("Nie znaleziono tekstu!");
                    showView(dashboardView); // Go back if text not found
                 }
            }


            // --- Event Listeners ---
            addNewTextBtn.addEventListener('click', () => {
                showEditForm(); // Show form for adding new text
            });

            cancelEditBtn.addEventListener('click', () => {
                showView(dashboardView); // Go back to dashboard without saving
            });

            saveTextBtn.addEventListener('click', saveText);

             backToDashboardBtn.addEventListener('click', () => {
                 // TODO: Maybe ask for confirmation if game is in progress?
                 showView(dashboardView);
             });

            // Event delegation for buttons within tiles
            textTilesContainer.addEventListener('click', (event) => {
                 const button = event.target.closest('button'); // Find the clicked button
                 if (!button) return; // Exit if click wasn't on a button

                 const id = parseInt(button.dataset.id, 10);

                 if (button.classList.contains('btn-study')) {
                     startLearning(id);
                 } else if (button.classList.contains('btn-edit')) {
                     const textToEdit = learningTexts.find(text => text.id === id);
                     if (textToEdit) {
                         showEditForm(textToEdit);
                     }
                 } else if (button.classList.contains('btn-delete')) {
                     deleteText(id);
                 }
             });


            // --- Initial Setup ---
            renderDashboard(); // Display initial tiles
            showView(dashboardView); // Start with the dashboard view

        });
    </script>

</body>
</html>
