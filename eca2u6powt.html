<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktywna Checklista z Quizem - Rozdział 6</title>
    <style>
        /* CSS Styles (pozostają takie same jak w poprzedniej wersji) */
        body {
            font-family: sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            background-color: #fff;
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #0056b3;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 8px;
            text-align: center;
        }
        h3 {
            color: #333;
            margin-top: 25px;
            font-size: 1.2em;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
            border: 1px solid #eee;
        }
        label:hover {
            background-color: #f0f8ff;
        }
        input[type="checkbox"], input[type="radio"] { /* Dodano radio dla quizu */
            margin-right: 12px;
            vertical-align: middle;
            transform: scale(1.1);
        }
        .task, #finalQuiz, #testBContent { /* Dodano quiz i testB */
            display: none; /* Initially hide all */
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fdfdfd;
        }
        .task.active, #finalQuiz.active, #testBContent.active { /* Dodano quiz i testB */
            display: block; /* Show the current */
        }
        .sub-heading {
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 10px;
            color: #555;
            font-size: 1.05em;
        }
        .level-basic {
             border-left: 3px solid #4CAF50;
             padding-left: 10px;
        }
        .level-advanced {
             border-left: 3px solid #FFC107;
             padding-left: 10px;
        }
        .level-tag {
            font-weight: bold;
            font-size: 0.85em;
            margin-left: 8px;
            padding: 2px 5px;
            border-radius: 3px;
            color: #fff;
        }
        .tag-basic { background-color: #4CAF50; } /* Green */
        .tag-advanced { background-color: #FF9800; } /* Orange */

        .navigation {
            text-align: center;
            margin-top: 30px;
        }
        button {
            padding: 12px 25px;
            font-size: 1em;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s ease;
            margin: 0 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .task-feedback {
            display: none;
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #007bff;
            background-color: #e7f3ff;
            border-radius: 5px;
        }
         .task-feedback h4 {
             margin-top: 0;
             color: #0056b3;
             border-bottom: 1px solid #0056b3;
             padding-bottom: 5px;
         }
        .task-feedback ul {
            list-style-type: none;
            padding-left: 0;
        }
         .task-feedback li {
             margin-bottom: 10px;
             padding: 8px;
             background-color: #fff;
             border-radius: 3px;
             border-left: 4px solid #dc3545;
         }
         .feedback-item-pl { font-weight: bold; }
         .feedback-item-en, .feedback-item-expl {
             display: block;
             margin-left: 10px;
             font-size: 0.95em;
             color: #333;
             margin-top: 3px;
         }
         .feedback-item-expl { font-style: italic; color: #555; }

         /* Quiz Styles */
         .quiz-question {
             margin-bottom: 20px;
             padding: 15px;
             border: 1px solid #eee;
             border-radius: 4px;
         }
         .quiz-question p {
             font-weight: bold;
             margin-bottom: 10px;
         }
         .quiz-options label {
             font-weight: normal;
             border: none;
             padding: 5px 0;
         }
         .quiz-options label:hover {
             background-color: transparent;
         }
         #quizResult {
            display: none;
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
         }
         .result-pass { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
         .result-fail { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }

         /* Test B Styles */
         #testBContent h2 { color: #28a745; border-color: #28a745; }
         .test-section {
             margin-top: 15px;
             padding: 10px;
             border: 1px dashed #ccc;
             background-color: #f9f9f9;
         }
         .test-section h4 { color: #555; margin-top: 0; }

    </style>
</head>
<body>

<div class="container">
    <h1>Interaktywna Checklista z Quizem - Rozdział 6</h1>
    <p id="intro">Przejdź przez kolejne zadania, zaznaczając słowa i zasady gramatyczne, które już znasz. Po każdym zadaniu kliknij "Sprawdź", aby zobaczyć, co warto powtórzyć, a następnie "Następne zadanie".</p>

    <!-- ====================================================== -->
    <!-- TASK SECTIONS (1-9) - Treść taka sama jak poprzednio   -->
    <!-- Wklej tutaj wszystkie 9 sekcji .task z poprzedniej odpowiedzi -->
    <!-- Poniżej przykład tylko dla Task 1, resztę dodaj analogicznie -->
    <!-- ====================================================== -->

    <div class="task" data-task-id="1" data-task-name="LISTENING: Zadanie 1 - Przepis">
        <h2>LISTENING</h2>
        <h3>Zadanie 1: Uzupełnianie przepisu (Track 6 - Tosty francuskie)</h3>
        <p class="sub-heading">Słownictwo (rozumienie ze słuchu):</p>
        <label class="level-basic"><input type="checkbox" data-translation="eggs"> jajka <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="cups"> filiżanki / szklanki <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="milk"> mleko <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="salt"> sól <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="sugar"> cukier <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="butter"> masło <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="bread"> chleb <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="beat"> ubijać <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="bowl"> miska <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="add"> dodawać <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="slice"> kroić w plastry <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="pieces"> kawałki / kromki <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-advanced"><input type="checkbox" data-translation="recipe"> przepis <span class="level-tag tag-advanced">Rozszerzenie</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="put"> kłaść / wkładać <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="frying pan"> patelnia <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="fry"> smażyć <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="minutes"> minuty <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="side"> strona (np. patelni) <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="seconds"> sekundy <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="serve"> podawać (jedzenie) <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="jam"> dżem <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="honey"> miód <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="fruit"> owoce <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="three, one and a half, eight, two, fifteen"> liczebniki (three, one and a half / 1/2, eight, two, fifteen / 15) <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-translation="a little, some"> określenia (a little, some) <span class="level-tag tag-basic">Podstawa</span></label>
        <p class="sub-heading">Gramatyka (rozumienie ze słuchu):</p>
        <label class="level-basic"><input type="checkbox" data-explanation="Tryb rozkazujący to po prostu czasownik w podstawowej formie (np. 'Add salt!'). Używamy go do wydawania poleceń, instrukcji (jak w przepisie) lub próśb."> Rozumienie trybu rozkazującego (poleceń w przepisie) <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-basic"><input type="checkbox" data-explanation="Musisz rozumieć liczby (np. 'two minutes') i słowa takie jak 'some' (trochę), 'a little' (mało), 'a cup of' (filiżanka czegoś), aby wiedzieć, ile czego dodać."> Rozumienie określeń ilości i liczb <span class="level-tag tag-basic">Podstawa</span></label>
        <label class="level-advanced"><input type="checkbox" data-explanation="Słowa takie jak 'First' (najpierw), 'Then' (potem), 'Next' (następnie), 'Finally' (na koniec) pokazują, w jakiej kolejności trzeba wykonywać czynności w przepisie."> Rozumienie sekwencji czynności (First, Then) <span class="level-tag tag-advanced">Rozszerzenie</span></label>
        <!-- Feedback Area for this task -->
        <div class="task-feedback" id="feedback-1"></div>
    </div>
    <!-- TUTAJ WKLEJ SEKCJE .task DLA ZADAŃ 2-9 Z POPRZEDNIEJ ODPOWIEDZI -->
    <!-- Pamiętaj, aby każda sekcja miała unikalne id dla feedbacku, np. id="feedback-2", id="feedback-3" itd. -->


    <!-- ====================================================== -->
    <!-- FINAL QUIZ SECTION -->
    <!-- ====================================================== -->
    <div id="finalQuiz">
        <h2>Quiz Sprawdzający (Podstawy)</h2>
        <p>Sprawdźmy najważniejsze rzeczy! Odpowiedz na pytania.</p>
        <form id="quizForm">
            <!-- Pytanie 1 (Vocab) -->
            <div class="quiz-question">
                <p>1. Co oznacza słowo 'delicious'?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q1" value="0"> a) kwaśny</label>
                    <label><input type="radio" name="q1" value="1"> b) pyszny</label> <!-- Poprawna -->
                    <label><input type="radio" name="q1" value="0"> c) słony</label>
                </div>
            </div>
            <!-- Pytanie 2 (Vocab) -->
            <div class="quiz-question">
                <p>2. Wybierz polskie tłumaczenie słowa 'bake' (używanego przy ciastach):</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q2" value="0"> a) smażyć</label>
                    <label><input type="radio" name="q2" value="0"> b) gotować</label>
                    <label><input type="radio" name="q2" value="1"> c) piec</label> <!-- Poprawna -->
                </div>
            </div>
             <!-- Pytanie 3 (Vocab) -->
            <div class="quiz-question">
                <p>3. Czego użyjesz do jedzenia zupy?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q3" value="0"> a) fork</label>
                    <label><input type="radio" name="q3" value="0"> b) knife</label>
                    <label><input type="radio" name="q3" value="1"> c) spoon</label> <!-- Poprawna -->
                </div>
            </div>
             <!-- Pytanie 4 (Vocab) -->
            <div class="quiz-question">
                <p>4. Które słowo oznacza 'kroić w plastry'?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q4" value="0"> a) chop</label>
                    <label><input type="radio" name="q4" value="1"> b) slice</label> <!-- Poprawna -->
                    <label><input type="radio" name="q4" value="0"> c) mix</label>
                </div>
            </div>
             <!-- Pytanie 5 (Vocab) -->
            <div class="quiz-question">
                <p>5. Jak powiesz 'forma do pieczenia ciasta'?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q5" value="0"> a) frying pan</label>
                    <label><input type="radio" name="q5" value="1"> b) cake tin</label> <!-- Poprawna -->
                    <label><input type="radio" name="q5" value="0"> c) pot</label>
                </div>
            </div>
             <!-- Pytanie 6 (Grammar - PP Affirmative) -->
            <div class="quiz-question">
                <p>6. Wybierz poprawną formę: She ___ (make) a cake.</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q6" value="0"> a) have made</label>
                    <label><input type="radio" name="q6" value="0"> b) has make</label>
                    <label><input type="radio" name="q6" value="1"> c) has made</label> <!-- Poprawna -->
                </div>
            </div>
             <!-- Pytanie 7 (Grammar - PP Negative) -->
            <div class="quiz-question">
                <p>7. Wybierz poprawną formę: We ___ (not clean) the room.</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q7" value="1"> a) haven't cleaned</label> <!-- Poprawna -->
                    <label><input type="radio" name="q7" value="0"> b) hasn't cleaned</label>
                    <label><input type="radio" name="q7" value="0"> c) haven't clean</label>
                </div>
            </div>
             <!-- Pytanie 8 (Grammar - PP Question) -->
            <div class="quiz-question">
                <p>8. Wybierz poprawne pytanie: ___ (you / wash) the dishes?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q8" value="0"> a) Has you washed</label>
                    <label><input type="radio" name="q8" value="1"> b) Have you washed</label> <!-- Poprawna -->
                    <label><input type="radio" name="q8" value="0"> c) Have you wash</label>
                </div>
            </div>
             <!-- Pytanie 9 (Grammar - Past Participle) -->
            <div class="quiz-question">
                <p>9. Jaka jest III forma (Past Participle) czasownika 'eat'?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q9" value="0"> a) eated</label>
                    <label><input type="radio" name="q9" value="0"> b) ate</label>
                    <label><input type="radio" name="q9" value="1"> c) eaten</label> <!-- Poprawna -->
                </div>
            </div>
             <!-- Pytanie 10 (Grammar - Imperative) -->
            <div class="quiz-question">
                <p>10. Którego słowa użyjesz w poleceniu '___ sól!' (Dodaj sól!)?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q10" value="0"> a) Adding</label>
                    <label><input type="radio" name="q10" value="0"> b) Adds</label>
                    <label><input type="radio" name="q10" value="1"> c) Add</label> <!-- Poprawna -->
                </div>
            </div>
            <!-- Dodaj więcej pytań, aby dobić do ok. 20 punktów, np. 10 pytań po 2 pkt -->
            <!-- ... (kolejne 10 pytań) ... -->

            <div class="navigation">
                <button type="button" onclick="submitQuiz()">Zakończ Quiz</button>
            </div>
        </form>
        <div id="quizResult"></div>
    </div>

    <!-- ====================================================== -->
    <!-- TEST B CONTENT SECTION -->
    <!-- ====================================================== -->
    <div id="testBContent">
        <h2>Gratulacje! Wynik quizu pozwala Ci zobaczyć Test B!</h2>
        <p>Oto przykładowa struktura zadań z Testu B. Przećwicz je, aby jeszcze lepiej przygotować się do sprawdzianu.</p>
        <div class="test-section">
            <h4>LISTENING (Zadanie 1 - Przepis)</h4>
            <p><strong>Instrukcja:</strong> Posłuchaj nagrania (tego samego co wcześniej) i uzupełnij luki w przepisie na tosty francuskie (wersja B może mieć inne luki niż wersja A).</p>
            <p><em>Miejsce na treść zadania 1 z Testu B...</em></p>
        </div>
        <div class="test-section">
            <h4>VOCABULARY (Zadanie 2, 3, 4)</h4>
            <p><strong>Instrukcja (Zad. 2):</strong> Wybierz poprawne słowa w przepisie na ciasteczka (inne opcje niż w Teście A).</p>
            <p><strong>Instrukcja (Zad. 3):</strong> Uzupełnij zdania nazwami przedmiotów kuchennych (inne zdania/przedmioty niż w Teście A).</p>
            <p><strong>Instrukcja (Zad. 4):</strong> Uzupełnij wyrazy opisujące jedzenie (inne przymiotniki/luki niż w Teście A).</p>
            <p><em>Miejsce na treść zadań 2, 3, 4 z Testu B...</em></p>
        </div>
        <div class="test-section">
            <h4>GRAMMAR (Zadanie 5, 6)</h4>
            <p><strong>Instrukcja (Zad. 5):</strong> Uzupełnij notatkę czasownikami w czasie Present Perfect (inna notatka/czasowniki niż w Teście A).</p>
            <p><strong>Instrukcja (Zad. 6):</strong> Napisz pytania i odpowiedzi w czasie Present Perfect (inne przykłady niż w Teście A).</p>
            <p><em>Miejsce na treść zadań 5, 6 z Testu B...</em></p>
        </div>
        <div class="test-section">
            <h4>SPEAKING (Zadanie 7)</h4>
            <p><strong>Instrukcja:</strong> Wybierz poprawne odpowiedzi w dialogach (inne dialogi/opcje niż w Teście A).</p>
            <p><em>Miejsce na treść zadania 7 z Testu B...</em></p>
        </div>
        <div class="test-section">
            <h4>READING (Zadanie 8)</h4>
            <p><strong>Instrukcja:</strong> Przeczytaj opisy kawiarni (te same teksty, ale inne pytania lub inna kolejność niż w Teście A) i odpowiedz na pytania.</p>
            <p><em>Miejsce na treść zadania 8 z Testu B...</em></p>
        </div>
        <div class="test-section">
            <h4>WRITING (Zadanie 9)</h4>
            <p><strong>Instrukcja:</strong> Napisz przepis na ciasto jabłkowe na podstawie obrazków (te same obrazki, ale uczeń pisze samodzielnie).</p>
            <p><em>Miejsce na treść zadania 9 z Testu B...</em></p>
        </div>
    </div>


    <!-- Navigation Buttons -->
    <div class="navigation">
        <button id="prevBtn" onclick="navigateTask(-1)" disabled>Poprzednie zadanie</button>
        <button id="checkBtn" onclick="checkCurrentTask()">Sprawdź</button>
        <button id="nextBtn" onclick="navigateTask(1)" disabled>Następne zadanie</button> <!-- Initially disabled -->
        <button id="restartBtn" onclick="restartChecklist()" style="display: none; background-color: #6c757d;">Zacznij od nowa</button>
    </div>

</div>

<script>
    let currentTaskIndex = 0;
    const tasks = document.querySelectorAll('.task');
    const prevBtn = document.getElementById('prevBtn');
    const checkBtn = document.getElementById('checkBtn');
    const nextBtn = document.getElementById('nextBtn');
    const restartBtn = document.getElementById('restartBtn');
    const introP = document.getElementById('intro');
    const container = document.querySelector('.container');
    const finalQuizDiv = document.getElementById('finalQuiz');
    const quizForm = document.getElementById('quizForm');
    const quizResultDiv = document.getElementById('quizResult');
    const testBContentDiv = document.getElementById('testBContent');
    const TOTAL_QUIZ_POINTS = 10; // Zakładamy 10 pytań po 2 pkt = 20 pkt max. Ustaw na 10 dla 10 pytań po 1 pkt.
    const PASSING_SCORE = 9; // Próg 18/20 to 9/10 przy pytaniach za 1 pkt.

    function showTask(index) {
        // Hide all feedback areas first
        document.querySelectorAll('.task-feedback').forEach(fb => fb.style.display = 'none');
        // Hide quiz and test B
        finalQuizDiv.classList.remove('active');
        testBContentDiv.classList.remove('active');
        quizResultDiv.style.display = 'none'; // Hide previous quiz result

        tasks.forEach((task, i) => {
            task.classList.toggle('active', i === index);
        });
        updateNavigationButtons();
        container.scrollTop = 0;
        window.scrollTo({ top: container.offsetTop - 20, behavior: 'smooth' });
    }

    function updateNavigationButtons() {
        prevBtn.disabled = currentTaskIndex === 0;
        nextBtn.disabled = true; // Disable "Next" until "Check" is clicked
        checkBtn.disabled = false; // Enable "Check"
        checkBtn.textContent = 'Sprawdź'; // Reset button text
        restartBtn.style.display = 'inline-block';

        // Hide navigation if quiz or test B is active
         if (finalQuizDiv.classList.contains('active') || testBContentDiv.classList.contains('active')) {
             prevBtn.style.display = 'none';
             checkBtn.style.display = 'none';
             nextBtn.style.display = 'none';
         } else {
             prevBtn.style.display = 'inline-block';
             checkBtn.style.display = 'inline-block';
             nextBtn.style.display = 'inline-block';
         }
    }

    function generateTaskFeedback(taskIndex) {
        const currentTask = tasks[taskIndex];
        const feedbackDiv = currentTask.querySelector('.task-feedback');
        const uncheckedItems = currentTask.querySelectorAll('input[type="checkbox"]:not(:checked)');
        let feedbackHTML = '';

        if (uncheckedItems.length > 0) {
            feedbackHTML += `<h4>Do powtórki z tego zadania:</h4><ul>`;
            uncheckedItems.forEach(item => {
                const label = item.closest('label');
                const levelSpan = label.querySelector('.level-tag');
                const levelText = levelSpan ? levelSpan.outerHTML : '';
                const translation = item.dataset.translation || '';
                const explanation = item.dataset.explanation || '';
                const itemText = Array.from(label.childNodes)
                                        .filter(node => node.nodeType === Node.TEXT_NODE)
                                        .map(node => node.textContent.trim())
                                        .join(' ');

                feedbackHTML += `<li>`;
                feedbackHTML += `<span class="feedback-item-pl">${itemText}</span> ${levelText}`;
                if (translation) {
                    feedbackHTML += `<span class="feedback-item-en">Tłumaczenie: ${translation}</span>`;
                }
                if (explanation) {
                    feedbackHTML += `<span class="feedback-item-expl">Wyjaśnienie: ${explanation}</span>`;
                }
                feedbackHTML += `</li>`;
            });
            feedbackHTML += `</ul>`;
        } else {
            feedbackHTML = `<h4>Gratulacje!</h4><p>Wygląda na to, że wszystko z tego zadania umiesz!</p>`;
        }

        feedbackDiv.innerHTML = feedbackHTML;
        feedbackDiv.style.display = 'block';
        feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function checkCurrentTask() {
        generateTaskFeedback(currentTaskIndex);
        nextBtn.disabled = false; // Enable "Next" button after checking
        checkBtn.disabled = true; // Disable "Check" button after clicking
        checkBtn.textContent = 'Sprawdzone!'; // Change button text
    }

    function navigateTask(direction) {
        const nextIndex = currentTaskIndex + direction;

        if (direction > 0) { // Moving forward
             // Hide feedback of the task we are leaving
             const currentFeedbackDiv = tasks[currentTaskIndex].querySelector('.task-feedback');
             if(currentFeedbackDiv) currentFeedbackDiv.style.display = 'none';

            if (nextIndex < tasks.length) {
                currentTaskIndex = nextIndex;
                showTask(currentTaskIndex);
            } else {
                // Reached the end of tasks, show quiz
                tasks[currentTaskIndex].classList.remove('active'); // Hide last task
                finalQuizDiv.classList.add('active');
                updateNavigationButtons(); // Hide nav buttons
                window.scrollTo({ top: container.offsetTop - 20, behavior: 'smooth' });
            }
        } else { // Moving backward
             // Hide feedback of the task we are leaving
             const currentFeedbackDiv = tasks[currentTaskIndex].querySelector('.task-feedback');
             if(currentFeedbackDiv) currentFeedbackDiv.style.display = 'none';

            if (nextIndex >= 0) {
                currentTaskIndex = nextIndex;
                showTask(currentTaskIndex);
            }
        }
    }

    function submitQuiz() {
        let score = 0;
        const totalQuestions = quizForm.querySelectorAll('.quiz-question').length; // Get actual number of questions
        // Assuming 1 point per question for simplicity now
        const pointsPerQuestion = 1; // Change if needed (e.g., to 2 for 20 points total)
        const maxScore = totalQuestions * pointsPerQuestion;
        // Adjust passing score based on actual total points if needed
        const adjustedPassingScore = Math.ceil(0.9 * totalQuestions); // 90% threshold (18/20 or 9/10)


        for (let i = 1; i <= totalQuestions; i++) {
            const selectedAnswer = quizForm.querySelector(`input[name="q${i}"]:checked`);
            if (selectedAnswer && parseInt(selectedAnswer.value) === 1) {
                score += pointsPerQuestion;
            }
        }

        quizResultDiv.style.display = 'block';
        quizResultDiv.textContent = `Twój wynik: ${score} / ${maxScore} punktów.`;

        if (score >= adjustedPassingScore) {
            quizResultDiv.className = 'result-pass'; // Green background
            quizResultDiv.textContent += ' Gratulacje! Osiągnąłeś wymagany próg.';
            testBContentDiv.classList.add('active'); // Show Test B
            testBContentDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
            quizResultDiv.className = 'result-fail'; // Red background
            quizResultDiv.textContent += ' Niestety, wynik jest poniżej progu 18/20. Wróć do checklisty i powtórz materiał.';
            testBContentDiv.classList.remove('active'); // Hide Test B
        }
         // Hide the quiz form itself after submission
         quizForm.style.display = 'none';
    }


     function restartChecklist() {
         // Uncheck all checkboxes and radio buttons
         document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(inp => inp.checked = false);
         // Hide all feedback areas
         document.querySelectorAll('.task-feedback').forEach(fb => {
             fb.innerHTML = '';
             fb.style.display = 'none';
         });
         // Hide quiz, result and test B
         finalQuizDiv.classList.remove('active');
         quizResultDiv.style.display = 'none';
         testBContentDiv.classList.remove('active');
         quizForm.style.display = 'block'; // Show quiz form again if restarting

         // Reset to the first task
         currentTaskIndex = 0;
         showTask(currentTaskIndex);
         // Ensure buttons are in correct initial state
         checkBtn.disabled = false;
         checkBtn.textContent = 'Sprawdź';
         nextBtn.disabled = true;
         prevBtn.disabled = true;
         restartBtn.style.display = 'none';
         setTimeout(() => { restartBtn.style.display = 'inline-block'; }, 10);
     }

    // Initial setup
    showTask(currentTaskIndex);
    setTimeout(() => { restartBtn.style.display = 'inline-block'; }, 10);

</script>

</body>
</html>
